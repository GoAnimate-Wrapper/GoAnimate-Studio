(function(f,h){var l=50,a=20,e=2000,i=45,j=0.09,n=10,m=20000,g=GT.gettext("Sorry, your video is taking longer than usual to load. <br> Please wait a moment.");var d=((navigator.userAgent.indexOf("Safari")>-1)&&(navigator.userAgent.indexOf("Chrome")===-1)),k=d&&(c()<n);var p;function c(){var q=navigator.userAgent.match(/version\/([0-9\.]+)/i);return q?parseFloat(q[1]):-1}var o=function(q){this.containerElem=q;this.videoElem=q.find("#h5-preview-player");this.videoDom=this.videoElem.get(0);this.paused=this.videoDom.paused;this.controlElem=q.find(".video-controls");this.controlElemFadeOutTimer=null;this.playerOverlay=q.find(".player-overlay");this.replayButton=q.find(".replay-button");this.playbackButton=this.controlElem.find(".playback-button");this.seekBar=this.controlElem.find(".seek-bar");this.bufferedBar=this.seekBar.find(".buffered-bar");this.playedBar=this.seekBar.find(".played-bar");this.seekSliderThumb=this.seekBar.find(".slider-thumb");this.seekBarTooltip=this.seekBar.find(".time-tooltip");this.timeDisplayText=this.controlElem.find(".time-display .text");this.volumeControl=this.controlElem.find(".volume-control");this.volumeIcon=this.volumeControl.find(".volume-icon");this.volumeSlider=this.controlElem.find(".volume-slider");this.volumeSliderThumb=this.volumeSlider.find(".slider-thumb");this.volumeSliderValueBar=this.volumeSlider.find(".slider-track .track-value-bar");this.initEventListeners();this.videoLoaded=false;this.videoDom.volume=1;this.lastNoneZeroVolume=1;this.mouseDownOnSeekBar=false;this.mouseDownOnVolumeSlider=false};o.prototype.initEventListeners=function(){var q=this;this.playbackButton.on("click",function(){if(q.paused){q.videoDom.play()}else{q.videoDom.pause()}});this.replayButton.on("click",function(){q.videoDom.play()});this.videoElem.on("loadstart",function(){q.playerOverlay.removeClass("ended")}).on("loadeddata",function(){q.videoLoaded=true}).on("play",function(){q.paused=false;q.videoElem.removeClass("hidden")}).on("playing",function(){q.paused=false;q.playerOverlay.removeClass("ended");q.playbackButton.removeClass("paused");q.hideLoading();h.clearTimeout(q.controlElemFadeOutTimer);q.controlElemFadeOutTimer=h.setTimeout(function(){q.controlElem.fadeOut()},e);if(!q.videoDom.paused&&k&(q.videoDom.currentTime>=j)&&(q.safariHackItr!==undefined)){clearInterval(q.safariHackItr);q.safariHackItr=undefined}}).on("waiting",function(){q.showLoading();if(!q.videoDom.paused&&k&&(q.videoDom.currentTime===0)&&(q.safariHackItr===undefined)){q.safariHackItr=setInterval(function(){if(!q.videoDom.paused&&(q.videoDom.currentTime<j)&&(q.videoDom.duration>j)){try{q.videoDom.currentTime=j}catch(r){}}},i)}}).on("pause",function(){q.paused=true;q.playbackButton.addClass("paused")}).on("ended",function(){q.paused=true;q.playerOverlay.addClass("ended")});this.containerElem.on("mouseenter",function(){q.controlElem.fadeIn();h.clearTimeout(q.controlElemFadeOutTimer)}).on("mouseleave",function(){h.clearTimeout(q.controlElemFadeOutTimer);q.controlElemFadeOutTimer=h.setTimeout(function(){q.controlElem.fadeOut()},e)});setInterval(function(){var s=q.seekBar.width(),r=q.getVideoDuration(),t=q.videoDom.buffered.length,x=q.videoDom.currentTime;if(t===1){q.bufferedBar.width(q.videoDom.buffered.end(0)/r*s)}else{if(t>1){var w,u;for(var v=0;v<t;v++){w=q.videoDom.buffered.start(v);u=q.videoDom.buffered.end(v);if((x>=w)&&(x<=u)){q.bufferedBar.width(u/r*s);break}}}}if(!q.videoLoaded){return}var y=x/r*s;q.playedBar.css("width",y);q.seekSliderThumb.css("left",y);q.updateTimeDisplay()},a);this.seekBar.bind("mousedown",function(){q.playerOverlay.removeClass("ended");q.mouseDownOnSeekBar=true});this.volumeSlider.bind("mousedown",function(){q.mouseDownOnVolumeSlider=true});f(document).bind("mouseup",function(){q.mouseDownOnSeekBar=false;q.mouseDownOnVolumeSlider=false});this.seekBar.bind("click mousemove",function(v){var s=f(this).offset();var w=v.pageX-s.left;var r=q.seekBar.width();if(w<0){w=0}if(w>r){w=r}q.seekBarTooltip.css("left",w);var u=w/r*q.getVideoDuration();q.seekBarTooltip.text(q._formatTime(u));if(q._isMouseKeyPressed(v)||q.mouseDownOnSeekBar){try{q.seekSliderThumb.css("left",w);q.playedBar.css("width",w);q.videoDom.currentTime=w/r*q.getVideoDuration()}catch(t){}}});this.volumeIcon.bind("click",function(s){if(q.videoDom.volume===0){q.videoDom.volume=q.lastNoneZeroVolume}else{q.videoDom.volume=0}var r=q.videoDom.volume*l;q.volumeSliderThumb.css("left",r);q.volumeSliderValueBar.css("width",r);q.volumeControl.toggleClass("muted",(r===0))});this.volumeSlider.bind("click mousemove",function(t){if(q._isMouseKeyPressed(t)||q.mouseDownOnVolumeSlider){var r=f(this).offset();var u=t.pageX-r.left;if(u<0){u=0}if(u>l){u=l}q.volumeSliderThumb.css("left",u);q.volumeSliderValueBar.css("width",u);q.volumeControl.toggleClass("muted",(u===0));var s=u/l;q.videoDom.volume=s;if(s!==0){q.lastNoneZeroVolume=s}}})};o.prototype.updateTimeDisplay=function(){var r=this.videoDom.currentTime;var q=this.getVideoDuration();var s=this._formatTime(r)+" / "+this._formatTime(q);this.timeDisplayText.text(s)};o.prototype.getVideoDuration=function(){var q=this.videoDom.duration;if(isNaN(q)){return 0}return q};o.prototype.showLoading=function(r){var q=this;this.playerOverlay.removeClass("ended").addClass("loading");if(typeof r==="string"){this.playerOverlay.find(".loading-message").text(r)}if(!p){p=setTimeout(function(){q.playerOverlay.find(".loading-message").html(g)},m)}};o.prototype.hideLoading=function(){if(p){clearTimeout(p);p=null}this.playerOverlay.find(".loading-message").empty();this.playerOverlay.removeClass("loading")};o.prototype.reset=function(){this.paused=true;this.showLoading();this.videoElem.addClass("hidden");this.playbackButton.removeClass("paused")};o.prototype._formatTime=function(s){if(isNaN(s)){return"00:00"}s=Math.round(s);var q=Math.floor(s/60),r=s%60;if(q<10){q="0"+q}if(r<10){r="0"+r}return q+":"+r};o.prototype._isMouseKeyPressed=function(q){return q.type==="click"};var b=f("#h5-playerdiv");b.data("previewPlayerControl",new o(b))})(jQuery,window);